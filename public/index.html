<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數字密碼破解 - 多人在線版</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div id="app">
        <!-- 登入畫面 -->
        <div v-if="screen === 'login'" class="container animate__animated animate__fadeIn">
            <h1>數字密碼破解</h1>
            <div class="login-form">
                <input v-model="playerName" 
                       placeholder="輸入你的名字" 
                       @keyup.enter="createOrJoinRoom">
                <div class="button-group">
                    <button @click="showCreateRoom" 
                            class="primary-button">創建房間</button>
                    <button @click="showJoinRoom" 
                            class="secondary-button">加入房間</button>
                </div>
            </div>
        </div>

        <!-- 創建房間畫面 -->
        <div v-if="screen === 'createRoom'" class="container animate__animated animate__fadeIn">
            <h2>創建新房間</h2>
            <div class="room-settings">
                <div class="setting-item">
                    <label>最大玩家數：</label>
                    <select v-model="maxPlayers">
                        <option v-for="n in 3" :value="n+2">{{ n+2 }} 位玩家</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label>回合時間：</label>
                    <select v-model="turnTime">
                        <option :value="30">30 秒</option>
                        <option :value="45">45 秒</option>
                        <option :value="60">60 秒</option>
                    </select>
                </div>
            </div>
            <div class="button-group">
                <button @click="createRoom" 
                        class="primary-button">創建房間</button>
                <button @click="screen = 'login'" 
                        class="secondary-button">返回</button>
            </div>
        </div>

        <!-- 加入房間畫面 -->
        <div v-if="screen === 'joinRoom'" class="container animate__animated animate__fadeIn">
            <h2>加入房間</h2>
            <div class="join-form">
                <input v-model="roomId" 
                       placeholder="輸入房間代碼" 
                       @keyup.enter="joinRoom">
                <div class="button-group">
                    <button @click="joinRoom" 
                            class="primary-button">加入</button>
                    <button @click="screen = 'login'" 
                            class="secondary-button">返回</button>
                </div>
            </div>
        </div>

        <!-- 等待室畫面 -->
        <div v-if="screen === 'lobby'" class="container animate__animated animate__fadeIn">
            <h2>房間：{{ currentRoom.id }}</h2>
            <div class="lobby-info">
                <div class="player-list">
                    <h3>玩家列表</h3>
                    <div v-for="player in currentRoom.players" 
                         :key="player.id" 
                         class="player-item"
                         :class="{'ready': player.ready}">
                        {{ player.name }} 
                        <span v-if="player.ready" class="ready-tag">準備完成</span>
                    </div>
                </div>
                <div class="room-info">
                    <p>最大玩家數：{{ currentRoom.settings.maxPlayers }}</p>
                    <p>回合時間：{{ currentRoom.settings.turnTime }} 秒</p>
                </div>
            </div>
            <div class="button-group">
                <button v-if="!isReady" 
                        @click="playerReady" 
                        class="primary-button">準備</button>
                <button @click="leaveRoom" 
                        class="secondary-button">離開房間</button>
            </div>
        </div>

        <!-- 遊戲畫面 -->
        <div v-if="screen === 'game'" class="container animate__animated animate__fadeIn">
            <div class="game-header">
                <h2>房間：{{ currentRoom.id }}</h2>
                <div class="game-stats">
                    <div class="stat-card">
                        <div class="player-info">
                            當前玩家：{{ currentRoom.players[currentRoom.gameState.currentPlayer].name }}
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="timer" :class="{'warning': currentRoom.gameState.timeLeft <= 10}">
                            剩餘時間：{{ currentRoom.gameState.timeLeft }} 秒
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="attempts-info">
                            剩餘嘗試次數：{{ currentRoom.gameState.attemptsLeft }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="game-content">
                <div class="guess-input-container" v-if="isCurrentPlayer">
                    <input v-model="guess" 
                           maxlength="4" 
                           placeholder="輸入4位數字" 
                           :disabled="!isCurrentPlayer"
                           @keyup.enter="makeGuess"
                           class="animate__animated"
                           :class="{'animate__shakeX': invalidInput}">
                    <button @click="makeGuess" 
                            :disabled="!isCurrentPlayer"
                            class="primary-button">
                        猜！
                    </button>
                </div>

                <div v-else class="waiting-message">
                    等待 {{ currentRoom.players[currentRoom.gameState.currentPlayer].name }} 的回合
                </div>

                <div class="history">
                    <div v-for="(attempt, index) in currentRoom.gameState.attempts" 
                         :key="index" 
                         class="history-entry"
                         :class="{'animate__animated animate__fadeInUp': index === currentRoom.gameState.attempts.length - 1}">
                        {{ attempt.playerName }} 猜：{{ attempt.guess }} 
                        - {{ attempt.result.hit }} Hit, {{ attempt.result.blow }} Blow
                    </div>
                </div>
            </div>
        </div>

        <!-- 遊戲結束畫面 -->
        <div v-if="screen === 'gameOver'" class="container animate__animated animate__fadeIn">
            <h2>遊戲結束！</h2>
            <div class="game-result">
                <p v-if="winner">
                    恭喜 {{ winner.name }} 獲勝！
                </p>
                <p v-else>
                    遊戲結束，沒有人猜中密碼。
                </p>
                <p>正確答案是：{{ secretCode }}</p>
            </div>
            <div class="button-group">
                <button @click="restartGame" 
                        class="primary-button">再玩一次</button>
                <button @click="leaveRoom" 
                        class="secondary-button">離開房間</button>
            </div>
        </div>

        <!-- 錯誤提示 -->
        <div v-if="errorMessage" class="error-message animate__animated animate__shakeX">
            {{ errorMessage }}
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="/app.js"></script>
</body>
</html> 